package com.hummingbee.system;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.HashMap;

/**
 * Usage class that reads and writes serialized file storing all sprinkler usages
 * @author Nick
 *
 */
public class Usage {
	// usages serialized file path
	private static final String USAGES_FILE_PATH = "resources/usage.ser";
	// HashMap of sprinkler usages
	private static HashMap<String, Double> sprinklerUsages;
	
	// updates the stored usages and GUI
	public static void update(String sprinklerId, double usage) {
		// retrieve usages map
		sprinklerUsages = readUsage();
		// update the value for the sprinkler
		sprinklerUsages.put(sprinklerId, sprinklerUsages.get(sprinklerId) + usage);
		// write usages map
		writeUsage(sprinklerUsages);
	}
	
	private static HashMap<String, Double> readUsage() {
		HashMap<String, Double> map;
		try {
			FileInputStream fis = new FileInputStream(USAGES_FILE_PATH);
			ObjectInputStream ois = new ObjectInputStream(fis);
			map = (HashMap<String, Double>) ois.readObject();
			ois.close();
		} catch (IOException e) {
			// what to do on IOException? display a message?
			map = new HashMap<String, Double>();
			e.printStackTrace();
		} catch (Exception e) {
			map = new HashMap<String, Double>();
			e.printStackTrace();
		}
		
		return map;
	}
	
	private static void writeUsage(HashMap<String, Double> map) {
		try {
			FileOutputStream fos = new FileOutputStream(USAGES_FILE_PATH);
	        ObjectOutputStream oos = new ObjectOutputStream(fos);
	        oos.writeObject(map);
	        oos.close();
		} catch (FileNotFoundException e) {
			// didn't find the file, create it
			e.printStackTrace();
		} catch (IOException e) {
			// what to do on IOException? display a message?
			e.printStackTrace();
		}
	}

}
